version: 2

models:
  - name: orders_fact
    description: Orders Fact Table for Star

    meta:
        contains_pii: false
        owner: Data Analytics
        subject_matter_expert: Rob Hill

    columns:
      - name: order_fact_wid
        description: Primary Key generated by the data warehouse
        tests:
          - unique
          - not_null
    
      - name: order_wid
        description: Surrogate key generated by the data warehouse, foreign key tp orders.order_wid
        tests: 
          - relationships:
              to: ref('orders')
              field: order_wid   

      - name: product_wid
        description: Surrogate key generated by the data warehouse, foreign key tp products.product_wid
        tests: 
          - relationships:
              to: ref('products')
              field: product_wid   

      - name: order_total
        description: <
          The dollar sum of all line item amounts, discounts, shipping, taxes, and tips in USD

      - name: order_subtotal
        description: <
          The dollar sum of all line item amounts after discounts but before shipping, taxes, and tips in USD

      - name: order_line_item_quantity		
        description: The number of units ordered

      - name: order_line_item_price	
        description: The price of the order item
      
      - name: order_line_item_total_discount
        description: The total discount of the order item

      - name: order_line_item_revenue
        description: <
          The line item price multiplied by the number of units ordered minus the total discount
      

    metrics:
      - name: total_order_count
        label: orders
        model: ref('orders_fact')
        description: "The count of orders"
    
        calculation_method: count_distinct
        expression: order_id 
    
        timestamp: created_time
        time_grains: [day, week, month, quarter, year, all_time]
    
        dimensions:
          - product_size
          - product_style
          - product_sku
          - product_title
          - product_category

      - name: total_gross_revenue
        label: gross_revenue
        model: ref('orders_fact')
        description: "The sum of total line item revenue minus sum of line item discounts"
    
        calculation_method: sum
        expression: 
          - order_line_revenue
    
        dimensions:
          - product_size
          - product_style
          - product_sku
          - product_title
          - product_category

      - name: total_order_units
        label: total_units
        model: ref('orders_fact')
        description: "The sum of order line item quantities"
    
        calculation_method: sum
        expression: 
          - order_line_item_quantity
    
        dimensions:
          - product_size
          - product_style
          - product_sku
          - product_title
          - product_category

      - name: average_order_units
        label: avg_units
        model: ref('orders_fact')
        description: "The average of units per order"
    
        calculation_method: average
        expression: 
          - order_line_item_quantity
    
        dimensions:
          - product_size
          - product_style
          - product_sku
          - product_title
          - product_category

      - name: average_order_value
        label: avg_value
        model: ref('orders_fact')
        description: "The average of order subtotal"
    
        calculation_method: avgerage
        expression: 
          - order_subtotal
    
        dimensions:
          - product_size
          - product_style
          - product_sku
          - product_title
          - product_category